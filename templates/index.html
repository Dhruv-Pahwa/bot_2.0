<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MindCare Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-blue-50 to-teal-50 min-h-screen flex flex-col items-center justify-center font-sans">
  
  <!-- Header -->
  <div class="w-full max-w-lg text-center mb-4">
    <h1 class="text-3xl font-bold text-blue-700">üí¨ Resolve Chatbot</h1>
    <p class="text-gray-600 text-sm">Your AI companion for supportive conversations</p>
  </div>

  <!-- Chat Container -->
  <div class="bg-white shadow-xl rounded-2xl w-full max-w-lg flex flex-col h-[75vh] border border-blue-100">
    
    <!-- Messages -->
    <div id="chatbox" class="flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin scrollbar-thumb-blue-200">
      <!-- Messages injected here -->
    </div>

    <!-- Input -->
    <div class="p-3 border-t flex items-center bg-blue-50 rounded-b-2xl">
      <textarea id="userInput"
             placeholder="Type your thoughts..."
             rows="1"
             class="flex-1 border border-gray-300 rounded-lg p-2 resize-none focus:ring-2 focus:ring-blue-400 outline-none"></textarea>
      <button onclick="sendMessage()"
              class="ml-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 shadow">
        Send
      </button>
    </div>
  </div>

  <!-- Disclaimer -->
  <p class="text-xs text-gray-500 mt-3 max-w-lg text-center">
    ‚ö†Ô∏è This chatbot is for supportive conversations only. It is <strong>not a substitute</strong> for professional medical or psychological advice.
  </p>

  <script>
    async function sendMessage() {
      const input = document.getElementById("userInput");
      const chatbox = document.getElementById("chatbox");
      const userText = input.value.trim();
      if (!userText) return;

      // Append user message
      chatbox.innerHTML += `
        <div class="flex justify-end">
          <div class="bg-blue-500 text-white px-4 py-2 rounded-2xl shadow max-w-[70%] whitespace-pre-wrap">${userText}</div>
        </div>`;
      input.value = "";
      chatbox.scrollTop = chatbox.scrollHeight;

      // Typing indicator
      const typingEl = document.createElement("div");
      typingEl.className = "flex justify-start";
      typingEl.innerHTML = `<div class="bg-gray-200 text-gray-700 px-4 py-2 rounded-2xl shadow animate-pulse">...</div>`;
      chatbox.appendChild(typingEl);
      chatbox.scrollTop = chatbox.scrollHeight;

      // Send to backend
      const response = await fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: userText})
      });
      const data = await response.json();

      // Remove typing indicator
      chatbox.removeChild(typingEl);

      // Append bot reply
      chatbox.innerHTML += `
        <div class="flex justify-start">
          <div class="bg-gray-200 text-gray-700 px-4 py-2 rounded-2xl shadow max-w-[70%] whitespace-pre-wrap">${data.response}</div>
        </div>`;
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    // Enter = send, Shift+Enter = newline
    document.getElementById("userInput").addEventListener("keydown", function (e) {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault(); // prevent newline
        sendMessage();
      }
    });
  </script>
</body>
</html>
